//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

/*****************************************************************************
 *
 * Copyright (c) 2004-2007 Guido Wesdorp. All rights reserved.
 *
 * This software is distributed under the terms of the JSBase
 * License. See LICENSE.txt for license text.
 *
 *****************************************************************************/

/*****************************************************************************
 *
 * Copyright (c) 2004-2007 Guido Wesdorp. All rights reserved.
 *
 * This software is distributed under the terms of the JSBase
 * License. See LICENSE.txt for license text.
 *
 *****************************************************************************/

/*****************************************************************************
 *
 * Copyright (c) 2004-2007 Guido Wesdorp. All rights reserved.
 *
 * This software is distributed under the terms of the JSBase
 * License. See LICENSE.txt for license text.
 *
 *****************************************************************************/

/*
    minisax.js - Simple API for XML (SAX) library for JavaScript
    Copyright (C) 2004-2007 Guido Wesdorp
    email johnny@johnnydebris.net

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    $Id: minisax.js,v 1.5 2004/07/31 00:10:15 johnny Exp $

*/

/*  dommer.js - a (mostly) compliant subset of DOM level 2 for JS
    (c) Guido Wesdorp 2004-2007
    email johnny@debris.demon.nl

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    dommer.js

    This library provides a mostly compliant subset of the DOM API in core
    JavaScript. A number of methods aren't implemented, and there are a few
    semantic differences between the standard and this implementations, but
    it provides most of DOM level 2's features and is usable in almost all JS
    environments (also stand-alone ones).

    I started writing this mainly because of IE's lack of proper namespace 
    support, and to have a portable, reliable DOM implementation.

    Non-standard are:

    - Whitespace is never ignored.

    - Because of JS doesn't (by default) allow computing attributes on request,
      this API doesn't create Element.nodeName on setting element.prefix, 
      therefore a new method was added: Element.setPrefix (note that this
      is not required if the library is not used on browsers that don't
      support __defineGetter__ and __defineSetter__ (such as IE)).

    $Id: minisax.js,v 1.5 2004/07/31 00:10:15 johnny Exp $

*/

/*
    davclient.js - Low-level JavaScript WebDAV client implementation
    Copyright (C) 2004-2007 Guido Wesdorp
    email johnny@johnnydebris.net

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

*/

/* Low level (subset of) WebDAV client implementation 
        
            Basically what one would expect from a basic DAV client, it
            provides a method for every HTTP method used in basic DAV, it
            parses PROPFIND requests to handy JS structures and accepts 
            similar structures for PROPPATCH.
            
            Requests are handled asynchronously, so instead of waiting until
            the response is sent back from the server and returning the
            value directly, a handler is registered that is called when
            the response is available and the method that sent the request
            is ended. For that reason all request methods accept a 'handler'
            argument, which will be called (with 3 arguments: statuscode,
            statusstring and content (the latter only where appropriate))
            when the request is handled by the browser.
            The reason for this choice is that Mozilla sometimes freezes
            when using XMLHttpRequest for synchronous requests.

            The only 'public' methods on the class are the 'initialize'
            method, that needs to be called first thing after instantiating
            a DavClient object, and the methods that have a name similar to
            an HTTP method (GET, PUT, etc.). The latter all get at least a
            'path' argument, a 'handler' argument and a 'context' argument:

                'path' - an absolute path to the target resource
                'handler' - a function or method that will be called once
                        the request has finished (see below)
                'context' - the context used to call the handler, the
                        'this' variable inside methods, so usually the
                        object (instance) the handler is bound to (ignore 
                        when the handler is a function)

            All handlers are called with the same 3 arguments:
            
                'status' - the HTTP status code
                'statusstring' - a string representation (see STATUS_CODES
                        array above) of the status code
                'content' - can be a number of different things:
                        * when there was an error in a method that targets
                            a single resource, this contains the error body
                        * when there was an error in a method that targets
                            a set of resources (multi-status) it contains
                            a Root object instance (see below) that contains
                            the error messages of all the objects
                        * if the method was GET and there was no error, it
                            will contain the contents of the resource
                        * if the method was PROPFIND and there was no error,
                            it will contain a Root object (see below) that
                            contains the properties of all the resources
                            targeted
                        * if there was no error and there is no content to
                            return, it will contain null
                'headers' - a mapping (associative array) from lowercase header
                            name to value (string)

            Basic usage example:

                function handler(status, statusstring, content, headers) {
                    if (content) {
                        if (status != '200' && status != '204') {
                            if (status == '207') {
                                alert('not going to show multi-status ' +
                                        here...');
                            };
                            alert('Error: ' + statusstring);
                        } else {
                            alert('Content: ' + content);
                        };
                    };
                };

                var dc = new DavClient();
                dc.initialize('localhost');

                // create a directory
                dc.MKCOL('/foo', handler);

                // create a file and save some contents
                dc.PUT('/foo/bar.txt', 'baz?', handler);

                // load and alert it (alert happens in the handler)
                dc.GET('/foo/bar.txt', handler);

                // lock the file, we need to store the lock token from 
                // the result
                function lockhandler(status, statusstring, content, headers) {
                    if (status != '200') {
                        alert('Error unlocking: ' + statusstring);
                    } else {
                        window.CURRENT_LOCKTOKEN = headers.locktoken;
                    };
                };
                dc.LOCK('/foo/bar.txt', 'http://johnnydebris.net/', 
                            lockhandler);

                // run the following bit only if the lock was set properly
                if (window.CURRENT_LOCKTOKEN) {
                    // try to delete it: this will fail
                    dc.DELETE('/foo/bar.txt', handler);
                    
                    // now unlock it using the lock token stored above
                    dc.UNLOCK('/foo/bar.txt', window.CURRENT_LOCKTOKEN,
                              handler);
                };

                // delete the dir
                dc.DELETE('/foo', handler);

            For detailed information about the HTTP methods and how they
            can/should be used in a DAV context, see http://www.webdav.org.

            This library depends on version 0.3 of the 'dommer' package
            and version 0.2 of the 'minisax.js' package, both of which
            should be available from http://johnnydebris.net under the
            same license as this one (GPL).

            If you have questions, bug reports, or patches, please send an 
            email to johnny@johnnydebris.net.
        */

/*
    davfs.js - High-level JavaScript WebDAV client implementation
    Copyright (C) 2004-2007 Guido Wesdorp
    email johnny@johnnydebris.net

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    This is a high-level WebDAV interface, part of the 'davlib' JS package. 
    
    For more details, see davclient.js in the same package, or visit
    http://johnnydebris.net.

*/

function SAXParser(){}function SAXHandler(){}function createStack(){var stack=undefined;try{notdefined()}catch(e){stack=e.stack}return stack&&(stack=stack.split("\n"),stack.shift(),stack.shift()),stack?stack.join("\n"):""}function getLineNo(stack){if(!stack)return;stack=stack.toString().split("\n");var chunks=stack[0].split(":"),lineno=chunks[chunks.length-1];if(lineno!="0")return lineno}function getFileName(stack){if(!stack)return;stack=stack.toString().split("\n");var chunks=stack[0].split(":"),filename=chunks[chunks.length-2];return filename}(function(){function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&_.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&_.isFunction(b.isEqual))return b.isEqual(a);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var length=stack.length;while(length--)if(stack[length]==a)return!0;stack.push(a);var size=0,result=!0;if(className=="[object Array]"){size=a.length,result=size==b.length;if(result)while(size--)if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var key in a)if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],stack)))break}if(result){for(key in b)if(_.has(b,key)&&!(size--))break;result=!size}}return stack.pop(),result}var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return new wrapper(obj)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.3.3";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return obj==null?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),obj.length===+obj.length&&(results.length=obj.length),results)},_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var reversed=_.toArray(obj).reverse();return context&&!initial&&(iterator=_.bind(iterator,context)),initial?_.reduce(reversed,iterator,memo,context):_.reduce(reversed,iterator)},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){if(iterator.call(context,value,index,list))return result=value,!0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return obj==null?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},_.reject=function(obj,iterator,context){var results=[];return obj==null?results:(each(obj,function(value,index,list){iterator.call(context,value,index,list)||(results[results.length]=value)}),results)},_.every=_.all=function(obj,iterator,context){var result=!0;return obj==null?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return obj==null?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker}),!!result)};_.include=_.contains=function(obj,target){var found=!1;return obj==null?found:nativeIndexOf&&obj.indexOf===nativeIndexOf?obj.indexOf(target)!=-1:(found=any(obj,function(value){return value===target}),found)},_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method||value:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var shuffled=[],rand;return each(obj,function(value,index,list){rand=Math.floor(Math.random()*(index+1)),shuffled[index]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sortBy=function(obj,val,context){var iterator=_.isFunction(val)?val:function(obj){return obj[val]};return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a===void 0?1:b===void 0?-1:a<b?-1:a>b?1:0}),"value")},_.groupBy=function(obj,val){var result={},iterator=_.isFunction(val)?val:function(obj){return obj[val]};return each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value)}),result},_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=low+high>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):_.isArguments(obj)?slice.call(obj):obj.toArray&&_.isFunction(obj.toArray)?obj.toArray():_.values(obj):[]},_.size=function(obj){return _.isArray(obj)?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return n!=null&&!guard?slice.call(array,0,n):array[0]},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))},_.last=function(array,n,guard){return n!=null&&!guard?slice.call(array,Math.max(array.length-n,0)):array[array.length-1]},_.rest=_.tail=function(array,index,guard){return slice.call(array,index==null||guard?1:index)},_.compact=function(array){return _.filter(array,function(value){return!!value})},_.flatten=function(array,shallow){return _.reduce(array,function(memo,value){return _.isArray(value)?memo.concat(shallow?value:_.flatten(value)):(memo[memo.length]=value,memo)},[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array,results=[];return array.length<3&&(isSorted=!0),_.reduce(initial,function(memo,value,index){if(isSorted?_.last(memo)!==value||!memo.length:!_.include(memo,value))memo.push(value),results.push(array[index]);return memo},[]),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=_.flatten(slice.call(arguments,1),!0);return _.filter(array,function(value){return!_.include(rest,value)})},_.zip=function(){var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results},_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(i in array&&array[i]===item)return i;return-1},_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(i in array&&array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);while(idx<len)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(this instanceof bound){ctor.prototype=func.prototype;var self=new ctor,result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return func.apply(context,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return funcs.length==0&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait){var context,args,timeout,throttling,more,result,whenDone=_.debounce(function(){more=throttling=!1},wait);return function(){context=this,args=arguments;var later=function(){timeout=null,more&&func.apply(context,args),whenDone()};return timeout||(timeout=setTimeout(later,wait)),throttling?more=!0:result=func.apply(context,args),whenDone(),throttling=!0,result}},_.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)};immediate&&!timeout&&func.apply(context,args),clearTimeout(timeout),timeout=setTimeout(later,wait)}},_.once=function(func){var ran=!1,memo;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments))}},_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments,0));return wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return times<=0?func():function(){if(--times<1)return func.apply(this,arguments)}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){return _.map(obj,_.identity)},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var result={};return each(_.flatten(slice.call(arguments,1)),function(key){key in obj&&(result[key]=obj[key])}),result},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]==null&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isEqual=function(a,b){return eq(a,b,[])},_.isEmpty=function(obj){if(obj==null)return!0;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!!obj&&obj.nodeType==1},_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"},_.isObject=function(obj){return obj===Object(obj)},_.isArguments=function(obj){return toString.call(obj)=="[object Arguments]"},_.isArguments(arguments)||(_.isArguments=function(obj){return!!obj&&!!_.has(obj,"callee")}),_.isFunction=function(obj){return toString.call(obj)=="[object Function]"},_.isString=function(obj){return toString.call(obj)=="[object String]"},_.isNumber=function(obj){return toString.call(obj)=="[object Number]"},_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj)},_.isNaN=function(obj){return obj!==obj},_.isBoolean=function(obj){return obj===!0||obj===!1||toString.call(obj)=="[object Boolean]"},_.isDate=function(obj){return toString.call(obj)=="[object Date]"},_.isRegExp=function(obj){return toString.call(obj)=="[object RegExp]"},_.isNull=function(obj){return obj===null},_.isUndefined=function(obj){return obj===void 0},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i)},_.escape=function(string){return(""+string).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name])})};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/.^/,escapes={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var p in escapes)escapes[escapes[p]]=p;var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,unescaper=/\\(\\|'|r|n|t|u2028|u2029)/g,unescape=function(code){return code.replace(unescaper,function(match,escape){return escapes[escape]})};_.template=function(text,data,settings){settings=_.defaults(settings||{},_.templateSettings);var source="__p+='"+text.replace(escaper,function(match){return"\\"+escapes[match]}).replace(settings.escape||noMatch,function(match,code){return"'+\n_.escape("+unescape(code)+")+\n'"}).replace(settings.interpolate||noMatch,function(match,code){return"'+\n("+unescape(code)+")+\n'"}).replace(settings.evaluate||noMatch,function(match,code){return"';\n"+unescape(code)+"\n;__p+='"})+"';\n";settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+source+"return __p;\n";var render=new Function(settings.variable||"obj","_",source);if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var wrapper=function(obj){this._wrapped=obj};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj},addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);return unshift.call(args,this._wrapped),result(func.apply(_,args),this._chain)}};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){var wrapped=this._wrapped;method.apply(wrapped,arguments);var length=wrapped.length;return(name=="shift"||name=="splice")&&length===0&&delete wrapped[0],result(wrapped,this._chain)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain)}}),wrapper.prototype.chain=function(){return this._chain=!0,this},wrapper.prototype.value=function(){return this._wrapped},define("underscore",[],function(){return _})})(),define("diffScanner",["underscore"],function(_){var DiffScanner=function(options){this._configure(options||{}),this.options=options};return _.extend(DiffScanner.prototype,{_configure:function(options){this.options={leftSide:[],rightSide:[]},this.options&&(options=_.extend({},this.options,options)),this.options=options,this.leftSide=this.options.leftSide,this.rightSide=this.options.rightSide},process:function(){var errors=[],writables=[],removables=[],ignored=[],self=this;return _.each(self.leftSide,function(lfile){var found=null;_.each(self.rightSide,function(rfile){if(self._sanitize(lfile.relativePath)===self._sanitize(rfile.relativePath)){found=rfile;if(lfile.size===0){ignored.push(rfile);return}if(lfile.lastTimestamp>rfile.lastTimestamp){lfile.isDir?ignored.push(rfile):lfile.size===rfile.size&&lfile.createTimestamp===lfile.lastTimestamp?ignored.push(rfile):writables.push(lfile);return}if(lfile.lastTimestamp===rfile.lastTimestamp){if(lfile.size===rfile.size){ignored.push(rfile);return}errors.push({ref:rfile.name,msg:"size differ for same timestamp",right:rfile,left:lfile});return}if(lfile.lastTimestamp<rfile.lastTimestamp){if(lfile.size===rfile.size){ignored.push(rfile);return}errors.push({ref:rfile.name,msg:"destination newer",right:rfile,left:lfile});return}}});if(!found)writables.push(lfile);else{var index=self.rightSide.indexOf(found);self.rightSide.splice(index,1),found=null}}),removables=this._reduceRemovables(this.rightSide),{writables:writables,removables:removables,ignored:ignored,errors:errors}},_sanitize:function(path){return path.replace(/\//g,Titanium.Filesystem.getSeparator())},_reduceRemovables:function(allRemovables){var removables=[];return _.each(allRemovables,function(item){var isFound=!1,i=0;for(i;i<removables.length;i++){if(removables[i].path.indexOf(item.path)===0){removables.splice(i,1,item),isFound=!0;break}if(item.path.indexOf(removables[i].path)===0){isFound=!0;break}}isFound||removables.push(item)}),removables}}),DiffScanner}),define("fileSync",["underscore","diffScanner"],function(_,DiffScanner){var FileSync=function(){console.log("FileSync")};return _.extend(FileSync.prototype,{initialize:function(local,remote,shipper,logger){this.local=local,this.remote=remote,this.shipper=shipper,this.logger=logger,this.forceSync=!1},checkOut:function(paths,forceSync,callbacks){this._log("checkOut in: "+paths.source),this._prepareSync(paths,!0,forceSync,callbacks)},checkIn:function(paths,forceSync,callbacks){this._log("checkIn in: "+paths.destination),this._prepareSync(paths,!1,forceSync,callbacks)},_log:function(msg){this.logger.writeln(msg)},_prepareSync:function(paths,toLocal,forceSync,callbacks){this.forceSync=forceSync,this.syncPaths=paths,this.source=toLocal?this.remote:this.local,this.destination=toLocal?this.local:this.remote,this._initCallbacks(callbacks);var self=this;this.source.readdir(paths.source,function(error,content){if(error){self._onError("fileSync._prepareSync","error reading source path: "+paths.source+" "+error);return}self.sourceTree=content,self.destination.readdir(paths.destination,function(error,content){if(error&&error!=="Not Found"){self._onError("fileSync._prepareSync","error reading local path: "+paths.destination+" "+error);return}self.destinationTree=content||[],self.diffFileSet=self._scan(self.sourceTree,self.destinationTree),self._sync(self.diffFileSet,self._syncCallback)})})},_scan:function(leftSide,rightSide){var diffScanner=new DiffScanner({leftSide:leftSide,rightSide:rightSide});return diffScanner.process()},_sync:function(syncReports,callback){this.transfer_errors=[],this.remove_errors=[],this.addedCount=0,this.removedCount=0;if(syncReports.errors.length>0){if(!this.forceSync){this._onError("sync aborted",this._scanErrorToString(syncReports.errors)),this._onComplete("_sync","sync aborted on scan error see log for details");return}this._onError("sync forced",this._scanErrorToString(syncReports.errors));var toAdd=_.pluck(syncReports.errors,"left");syncReports.writables=syncReports.writables.concat(toAdd)}this.actions=[{run:this._syncWriteNext,items:syncReports.writables},{run:this._syncRemoveNext,items:syncReports.removables}],this._syncActionNext()},_syncActionNext:function(){if(this.actions.length===0){this._syncCallback();return}var current=this.actions.shift();this.actionables=current.items,current.run.apply(this)},_syncWriteNext:function(){if(this.actionables.length===0){this._syncActionNext();return}var item=this.actionables.shift(),self=this;this._onProgress("write",item.path+"("+item.readSize()+")");if(item.isDir){var destinationDir=self.syncPaths.destination+item.relativePath;self.destination.mkdir(destinationDir,function(error){error&&self.transfer_errors.push({item:destinationDir,msg:error}),self._syncWriteNext()})}else{var destinationPath=this.destination.getFullPath(self.syncPaths.destination+item.relativePath);this._checkDestinationPath(destinationPath,function(error){if(error){self.transfer_errors.push({item:item.path,msg:error}),self._syncWriteNext();return}self.shipper.transfer({origin:self.source.getFullPath(item.path),destination:destinationPath},{onError:function(error){self.transfer_errors.push({item:item.path,msg:error}),self._syncWriteNext()},onComplete:function(){self.addedCount++,self._syncWriteNext()}})})}},_checkDestinationPath:function(path,callback){var self=this;this.destination.isDir(path,function(result){result?callback():self.destination.mkdir(path,function(error){callback(error)})})},_syncRemoveNext:function(){if(this.actionables.length===0){this._syncActionNext();return}var item=this.actionables.shift(),self=this;this._onProgress("remove",item.path),item.isDir?self.destination.rmdir(item.path,function(error){error&&self.remove_errors.push({item:item.path,msg:error}),self._syncRemoveNext()}):self.destination.rm(item.path,function(error){error?self.remove_errors.push({item:item.path,msg:error}):self.removedCount++,self._syncRemoveNext()})},_syncCallback:function(){var errors=[],errorCount=0;this.transfer_errors.length>0&&(this._log(this._writeErrorToString(this.transfer_errors)),errorCount+=this.transfer_errors.length),this.remove_errors.length>0&&(this._log(this._removeErrorToString(this.remove_errors)),errorCount+=this.remove_errors.length),this._onComplete("complete","added: "+this.addedCount+", removed: "+this.removedCount+", errors: "+errorCount,{added:this.addedCount,removed:this.removedCount,errors:errorCount})},_initCallbacks:function(callbacks){var onProgressCallback=callbacks.onProgress||function(){},onErrorCallback=callbacks.onError||function(){},onCompleteCallback=callbacks.onComplete||function(){},self=this;this._onProgress=function(method,msg){self._onActionLog(method,msg),onProgressCallback(msg)},this._onError=function(method,msg){self._onActionLog(method,msg),onErrorCallback(msg)},this._onComplete=function(method,msg,info){self._onActionLog(method,msg),onCompleteCallback(info)}},_scanErrorToString:function(errors){var report="SCAN ERROR BEGIN ===\n";return _.each(errors,function(error){report+="  "+error.ref+": "+error.msg+"\n"}),report+="=== SCAN ERROR END ===\n",report},_writeErrorToString:function(errors){var report="WRITE ERROR BEGIN ===\n";return _.each(errors,function(error){report+="  "+error.item+": "+error.msg+"\n"}),report+="=== WRITE ERROR END ===\n",report},_removeErrorToString:function(errors){var report="REMOVE ERROR BEGIN ===\n";return _.each(errors,function(error){report+="  "+error.item+": "+error.msg+"\n"}),report+="=== REMOVE ERROR END ===\n",report},_onActionLog:function(method,msg){this._log(method+": "+msg)}}),FileSync});var global=this;global.exception=new function(){var exception=this;this.Exception=function(message){message!==undefined&&this._initialize("Exception",message)},this.Exception.prototype._initialize=function(name,message){this.name=name,this.message=message;var stack=this.stack=exception._createStack();this.lineNo=exception._getLineNo(stack),this.fileName=exception._getFileName(stack)},this.Exception.prototype.toString=function(){var lineNo=this.lineNo,fileName=this.fileName,stack=this.stack,exc=this.name+": "+this.message+"\n";if(lineNo||fileName||stack)exc+="\n";fileName&&(exc+="file: "+fileName,lineNo?exc+=", ":exc+="\n"),lineNo&&(exc+="line: "+lineNo+"\n");if(stack){exc+="\n";var lines=stack.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i];line.charAt(0)=="("&&(line="function"+line),exc+=line+"\n"}}return exc},this.ValueError=function(message){message!==undefined&&this._initialize("ValueError",message)},this.ValueError.prototype=new this.Exception,this.AssertionError=function(message){message!==undefined&&this._initialize("AssertionError",message)},this.AssertionError.prototype=new this.Exception,this.NotSupported=function(message){message!==undefined&&this._initialize("NotSupported",message)},this.NotSupported.prototype=new this.Exception,this.NotFound=function(message){message!==undefined&&this._initialize("NotFound",message)},this.NotFound.prototype=new this.Exception,this.HTTPError=function(status){status!==undefined&&this._initialize("HTTPError",status)},this.HTTPError.prototype=new this.Exception,this.MissingDependency=function(missing,from){if(missing!==undefined){var message=missing;from&&(message+=" (from "+from+")"),this._initialize("MissingDependency",message)}},this.NotFound.prototype=new this.Exception,this._createStack=function(){var stack=undefined;try{notdefined()}catch(e){stack=e.stack}return stack&&(stack=stack.split("\n"),stack.shift(),stack.shift()),stack?stack.join("\n"):""},this._getLineNo=function(stack){if(!stack)return;stack=stack.toString().split("\n");var chunks=stack[0].split(":"),lineno=chunks[chunks.length-1];if(lineno!="0")return lineno},this._getFileName=function(stack){if(!stack)return;stack=stack.toString().split("\n");var chunks=stack[0].split(":"),filename=chunks[chunks.length-2];return filename}},define("davException",function(){});var global=this;global.string=new function(){var string=this;this.strip=function(s){var stripspace=/^\s*([\s\S]*?)\s*$/;return stripspace.exec(s)[1]},this.reduceWhitespace=function(s){s=s.replace(/\r/g," "),s=s.replace(/\t/g," "),s=s.replace(/\n/g," ");while(s.indexOf("  ")>-1)s=s.replace("  "," ");return s},this.entitize=function(s){var ret=s.replace(/&/g,"&amp;");return ret=ret.replace(/"/g,"&quot;"),ret=ret.replace(/</g,"&lt;"),ret=ret.replace(/>/g,"&gt;"),ret},this.deentitize=function(s){var ret=s.replace(/&gt;/g,">");return ret=ret.replace(/&lt;/g,"<"),ret=ret.replace(/&quot;/g,'"'),ret=ret.replace(/&amp;/g,"&"),ret},this.urldecode=function(s){var reg=/%([a-fA-F0-9]{2})/g,str=s;for(;;){var match=reg.exec(str);if(!match||!match.length)break;var repl=new RegExp(match[0],"g");str=str.replace(repl,String.fromCharCode(parseInt(match[1],16)))}return str=str.replace(/\+/g," "),str},this.urlencode=function(s){return escape(s)},this.escape=function(s){return s=s.replace(/\\/g,"\\\\"),s=s.replace(/\n/g,"\\\n"),s=s.replace(/\r/g,"\\\r"),s=s.replace(/\t/g,"\\	"),s=s.replace(/'/g,"\\'"),s=s.replace(/"/g,'\\"'),s},this.unescape=function(s){return s=s.replace(/\\\n/g,"\n"),s=s.replace(/\\\r/g,"\r"),s=s.replace(/\\\t/g,"	"),s=s.replace(/\\'/g,"'"),s=s.replace(/\\"/g,'"'),s=s.replace(/\\\\/g,"\\"),s},this.centerTruncate=function(s,maxlength){if(s.length<=maxlength)return s;var chunklength=maxlength/2-3,start=s.substr(0,chunklength),end=s.substr(s.length-chunklength);return start+" ... "+end},this.startsWith=function(s,start){return s.substr(0,start.length)==start},this.endsWith=function(s,end){return s.substr(s.length-end.length)==end},this.format=function(s,indent,maxwidth){if(indent.length>maxwidth)throw"Size of indent must be smaller than maxwidth";s=string.reduceWhitespace(s);var words=s.split(" "),lines=[];while(words.length){var currline=indent;for(;;){var word=words.shift();if(!word||currline.length>indent.length&&currline.length+word.length>maxwidth)break;currline+=word+" "}lines.push(currline)}return lines.join("\r\n")}},define("davString",function(){});var global=this;global.array=new function(){var array=this;this.contains=function(a,element,objectequality){return this.indexOf(a,element,!objectequality)>-1},this.indexOf=function(a,element,compareValues){for(var i=0;i<a.length;i++)if(!compareValues){if(element===a[i])return i}else if(element==a[i])return i;return-1},this.removeDoubles=function(a){var ret=[];for(var i=0;i<a.length;i++)this.contains(ret,a[i])||ret.push(a[i]);return ret},this.map=function(a,func){for(var i=0;i<a.length;i++)a[i]=func(a[i]);return this},this.reversed=function(a){var ret=[];for(var i=a.length;i>0;i--)ret.push(a[i-1]);return ret},this.StopIteration=function(message){message!==undefined&&this._initialize("StopIteration",message)},global.exception&&(this.StopIteration.prototype=global.exception.Exception);var Iterator=this.Iterator=function(a){a&&this._initialize(a)};Iterator._initialize=function(a){this._array=a,this._i=0},Iterator.next=function(){if(this._i>=this._array.length)throw this._i=0,StopIteration("no more items");return this._i++},this.iterate=function(a){if(!a.__iter_index__)a.__iter_index__=0;else if(a.__iter_index__>=a.length)return a.__iter_index__=undefined,undefined;return a[a.__iter_index__++]}},define("davArray",function(){}),SAXParser.prototype.initialize=function(xml,handler){this.xml=xml,this.handler=handler,this.handler.namespaceToPrefix={},this.starttagreg=/\<([^: \t\n]+:)?([a-zA-Z0-9\-_]+)([^\>]*?)(\/?)\>/m,this.endtagreg=/\<\/([^: \t\n]+:)?([a-zA-Z0-9\-_]+)[^\>]*\>/m,this.attrstringreg=/(([^:=]+:)?[^=]+=\"[^\"]*\")/m,this.attrreg=/([^=]*)=\"([^\"]*)\"/m,this._namespace_stack=[],this._current_nodename_stack=[],this._current_namespace_stack=[]},SAXParser.prototype.parse=function(){var xml=this._removeXMLdeclaration(this.xml);this.handler.startDocument();for(;;){var chunk=this._getNextChunk(xml);if(chunk=="")break;xml=xml.substr(chunk.length);if(chunk.charAt(0)=="<")if(chunk.charAt(1)=="/")this.handleEndTag(chunk),this._namespace_stack.pop();else if(chunk.charAt(1)=="!"){chunk=string.deentitize(chunk);if(!chunk.indexOf("-->")==chunk.length-3){var more=xml.substr(0,xml.indexOf("-->"));xml=xml.substr(more.length),chunk+=more}chunk=chunk.substr(4,chunk.length-7),this.handler.comment(chunk)}else{var singleton=!1;chunk.charAt(chunk.length-2)=="/"&&(singleton=!0),this._pushNamespacesToStack(),this.handleStartTag(chunk,singleton),singleton&&this._namespace_stack.pop()}else chunk=string.deentitize(chunk),this.handler.characters(chunk)}this.handler.endDocument()},SAXParser.prototype.handleStartTag=function(tag,is_singleton){var match=this.starttagreg.exec(tag);if(!match)throw"Broken start tag: "+tag;var prefix=match[1],nodename=match[2];prefix?prefix=prefix.substr(0,prefix.length-1):prefix="";var attrs=this._splitAttributes(match[3]);attrs=this._getAndHandleNamespaceDeclarations(attrs);var attributes={};for(var i=0;i<attrs.length;i++)this.handleAttribute(attrs[i],attributes);var namespace=this._namespace_stack[this._namespace_stack.length-1][prefix];this.handler.startElement(namespace,nodename,attributes),is_singleton?this.handler.endElement(namespace,nodename):(this._current_nodename_stack.push(nodename),this._current_namespace_stack.push(namespace))},SAXParser.prototype.handleEndTag=function(tag){var match=this.endtagreg.exec(tag);if(!match)throw"Broken end tag: "+tag;var prefix=match[1],nodename=match[2];prefix?prefix=prefix.substr(0,prefix.length-1):prefix="",namespace=this._namespace_stack[this._namespace_stack.length-1][prefix];var current_nodename=this._current_nodename_stack.pop(),current_namespace=this._current_namespace_stack.pop();if(nodename!=current_nodename||namespace!=current_namespace){var exc="Ending ";throw namespace!=""&&(exc+=namespace+":"),exc+=nodename+" doesn't match opening ",current_namespace!=""&&(exc+=current_namespace+":"),exc+=current_nodename,exc}this.handler.endElement(namespace,nodename)},SAXParser.prototype.handleAttribute=function(attr,attributemapping){var match=this.attrreg.exec(attr);if(!match)throw"Broken attribute: "+attr;var prefix="",name=match[1],lname=match[1],value=string.deentitize(match[2]);if(name.indexOf(":")>-1){var tuple=name.split(":");prefix=tuple[0],lname=tuple[1]}var namespace="";prefix=="xml"?(namespace="http://www.w3.org/XML/1998/namespace",this.handler.namespaceToPrefix[namespace]||(this.handler.namespaceToPrefix[namespace]=prefix)):prefix!=""&&(namespace=this._namespace_stack[this._namespace_stack.length-1][prefix]),attributemapping[namespace]||(attributemapping[namespace]={}),attributemapping[namespace][lname]=value},SAXParser.prototype._removeXMLdeclaration=function(xml){var declreg=/\<\?[^>]*\?\>/g;return xml=xml.replace(declreg,""),xml},SAXParser.prototype._getNextChunk=function(xml){return xml.charAt(0)=="<"?xml.substr(0,xml.indexOf(">")+1):xml.substr(0,xml.indexOf("<"))},SAXParser.prototype._splitAttributes=function(attrstring){var attrs=string.strip(attrstring),attrlist=[];for(;;){var match=this.attrstringreg.exec(attrstring);if(!match)break;attrlist.push(string.strip(match[1])),attrstring=attrstring.replace(match[0],"")}return attrlist},SAXParser.prototype._getAndHandleNamespaceDeclarations=function(attrarray){var leftover=[];for(var i=0;i<attrarray.length;i++){var attr=attrarray[i],match=this.attrreg.exec(attr);if(!match)throw"Broken attribute: "+attr;if(match[1].indexOf("xmlns")==-1){leftover.push(attr);continue}var nsname=match[1],value=string.deentitize(match[2]);nsname.indexOf(":")>-1?(nsname=nsname.split(":")[1],this._registerNamespace(value,nsname)):this._registerNamespace(value)}return leftover},SAXParser.prototype._registerNamespace=function(namespace,prefix){prefix||(prefix=""),this.handler.namespaceToPrefix[namespace]||(this.handler.namespaceToPrefix[namespace]=prefix),this._namespace_stack[this._namespace_stack.length-1][prefix]=namespace},SAXParser.prototype._pushNamespacesToStack=function(){var newnss={};for(var prefix in this._namespace_stack[this._namespace_stack.length-1])newnss[prefix]=this._namespace_stack[this._namespace_stack.length-1][prefix];this._namespace_stack.push(newnss)},SAXHandler.prototype.startDocument=function(){},SAXHandler.prototype.startElement=function(namespaceURI,nodeName,attributes){},SAXHandler.prototype.endElement=function(namespaceURI,nodeName){},SAXHandler.prototype.characters=function(chars){},SAXHandler.prototype.comment=function(comment){},SAXHandler.prototype.endDocument=function(){},define("davMinisax",function(){});var WARN_ON_PREFIX=!0;try{var global=window}catch(e){var global=this}global.dommer=new function(){function DOMException(errorcode,message){this.code=null,this.error=null,this.message=message;for(var attr in DOMException)if(DOMException[attr]==errorcode){this.error=attr;break}this.code=errorcode,this.error||(this.error="Unknown"),this.stack=stack=createStack(),this.lineNumber=getLineNo(stack),this.fileName=getFileName(stack)}function Node(){this.ELEMENT_NODE=1,this.ATTRIBUTE_NODE=2,this.TEXT_NODE=3,this.CDATA_SECTION_NODE=4,this.ENTITY_REFERENCE_NODE=5,this.ENTITY_NODE=6,this.PROCESSING_INSTRUCTION_NODE=7,this.COMMENT_NODE=8,this.DOCUMENT_NODE=9,this.DOCUMENT_TYPE_NODE=10,this.DOCUMENT_FRAGMENT_NODE=11,this.NOTATION_NODE=12,this._protectAttribute=function(attr){this.__defineSetter__(attr,function(value){throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR,attr)}),this.__defineGetter__(attr,function(){return this["_"+attr]})},this._setProtected=function(name,value){this["_"+name]=value,this.__defineSetter__||(this[name]=value)},this.nodeValue=null;if(this.__defineSetter__){this.__defineSetter__("nodeValue",function(nodeValue){if(this.nodeType!=this.TEXT_NODE&&this.nodeType!=this.ATTRIBUTE_NODE&&this.nodeType!=this.COMMENT_NODE)throw new DOMException(DOMException.NO_DATA_ALLOWED_ERR,"nodeValue");this._nodeValue=nodeValue}),this.__defineGetter__("nodeValue",function(){if(this.nodeType!=this.TEXT_NODE&&this.nodeType!=this.ATTRIBUTE_NODE&&this.nodeType!=this.COMMENT_NODE)throw new DOMException(DOMException.NO_DATA_ALLOWED_ERR,"nodeValue");return this._nodeValue});var toprotect=["nodeType","nodeName","parentNode","childNodes","firstChild","lastChild","previousSibling","nextSibling","attributes","ownerDocument","namespaceURI","localName"];for(var i=0;i<toprotect.length;i++)this._protectAttribute(toprotect[i])}this._setProtected("namespaceURI",null),this._setProtected("prefix",null),this._setProtected("nodeName",null),this._setProtected("localName",null),this._setProtected("parentNode",null),this._setProtected("childNodes",[]),this._setProtected("firstChild",null),this._setProtected("lastChild",null),this._setProtected("previousSibling",null),this._setProtected("nextSibling",null),this._setProtected("ownerDocument",null)}function DocumentFragment(){this._setProtected("nodeType",11)}function Element(){this._setProtected("nodeType",1)}function TextNode(){this._setProtected("nodeType",3),this._setProtected("nodeName","#text")}function CommentNode(){this._setProtected("nodeType",8),this._setProtected("nodeName","#comment")}function Attribute(){this._setProtected("nodeType",2)}function Document(){this._setProtected("nodeType",9),this._setProtected("nodeName","#document")}function DOMHandler(){}function DOM(){}function BaseArray(){for(var i=0;i<arguments.length;i++)this[i]=arguments[i];this.length=arguments.length}function NodeList(){}function NamedNodeMap(){}this.DOMException=DOMException,DOMException.INDEX_SIZE_ERR=1,DOMException.DOMSTRING_SIZE_ERR=2,DOMException.HIERARCHY_REQUEST_ERR=3,DOMException.WRONG_DOCUMENT_ERR=4,DOMException.INVALID_CHARACTER_ERR=5,DOMException.NO_DATA_ALLOWED_ERR=6,DOMException.NO_MODIFICATION_ALLOWED_ERR=7,DOMException.NOT_FOUND_ERR=8,DOMException.NOT_SUPPORTED_ERR=9,DOMException.INUSE_ATTRIBUTE_ERR=10,DOMException.INVALID_STATE_ERR=11,DOMException.SYNTAX_ERR=12,DOMException.INVALID_MODIFICATION_ERR=13,DOMException.NAMESPACE_ERR=14,DOMException.INVALID_ACCESS_ERR=15,DOMException.prototype.toString=function(){var ret="DOMException: "+this.error+" ("+this.code+")";return this.message&&(ret+=" - "+this.message),ret},this.Node=Node;var thrownotsupported=function(){throw"not supported"};Node.prototype.normalize=thrownotsupported,Node.prototype.isSupported=thrownotsupported,Node.prototype.setPrefix=function(prefix){this.__defineSetter__?(this._prefix=prefix,this._nodeName=prefix+":"+this.localName):(this.prefix=prefix,this.nodeName=prefix+":"+this.localName)},Node.prototype.cloneNode=function(){throw new DOMException(DOMException.NOT_SUPPORTED_ERR)},Node.prototype.hasChildNodes=function(){return this.childNodes&&this.childNodes.length>0},Node.prototype.hasAttributes=function(){return this.attributes!==undefined&&this.attributes.length},Node.prototype.appendChild=function(newChild){this._checkModificationAllowed(),this._attach(newChild)},Node.prototype.removeChild=function(oldChild){this._checkModificationAllowed(),this._checkIsChild(oldChild);var newChildren=new NodeList,found=!1;for(var i=0;i<this.childNodes.length;i++){if(this.childNodes[i]===oldChild){oldChild._setProtected("parentNode",null);var previous=oldChild.previousSibling;previous&&(oldChild._setProtected("previousSibling",null),previous._setProtected("nextSibling",oldChild.nextSibling));var next=oldChild.nextSibling;next&&(next._setProtected("previousSibling",previous),oldChild._setProtected("nextSibling",null));continue}newChildren.push(this.childNodes[i])}this._setProtected("childNodes",newChildren),this._setProtected("firstChild",this.childNodes.length>0?this.childNodes[0]:null),this._setProtected("lastChild",this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null)},Node.prototype.replaceChild=function(newChild,refChild){this._checkModificationAllowed(),this._checkIsChild(refChild),this._attach(newChild,refChild,!0)},Node.prototype.insertBefore=function(newChild,refChild){this._checkModificationAllowed(),this._checkIsChild(refChild),this._attach(newChild,refChild)},Node.prototype._attach=function(newChild,refChild,replace){if(newChild.ownerDocument!=this.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(newChild.nodeType!=newChild.ELEMENT_NODE&&newChild.nodeType!=newChild.TEXT_NODE&&newChild.nodeType!=newChild.CDATA_SECTION_NODE&&newChild.nodeType!=newChild.COMMENT_NODE)throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR);var currparent=this;while(currparent&&currparent.nodeType!=newChild.DOCUMENT_NODE){if(currparent===newChild)throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR);currparent=currparent.parentNode}newChild._setProtected("parentNode",this);if(!refChild)this.childNodes.length&&(this.childNodes[this.childNodes.length-1]._setProtected("nextSibling",newChild),newChild._setProtected("previousSibling",this.childNodes[this.childNodes.length-1])),this.childNodes.push(newChild);else{var newchildren=[],found=!1;for(var i=0;i<this.childNodes.length;i++){var currChild=this.childNodes[i];if(currChild===refChild){newchildren.push(newChild);var previous=this.childNodes[i-1];previous&&(newChild._setProtected("previousSibling",previous),previous._setProtected("nextSibling",newChild));if(!replace)newchildren.push(currChild),currChild._setProtected("previousSibling",newChild),newChild._setProtected("nextSibling",currChild);else{currChild._setProtected("parentNode",null),currChild._setProtected("previousSibling",null),currChild._setProtected("nextSibling",null);var next=this.childNodes[i+1];newChild._setProtected("nextSibling",next),next._setProtected("previousSibling",newChild)}found=!0}else newchildren.push(currChild)}if(!found)throw new DOMException(DOMException.NOT_FOUND_ERR);this._setProtected("childNodes",newchildren)}this._setProtected("firstChild",this.childNodes[0]),this._setProtected("lastChild",this.childNodes[this.childNodes.length-1])},Node.prototype._checkModificationAllowed=function(){if(this.nodeType!=this.ELEMENT_NODE&&this.nodeType!=this.DOCUMENT_NODE&&this.nodeType!=this.DOCUMENT_FRAGMENT_NODE)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR)},Node.prototype._checkIsChild=function(refChild){if(refChild.parentNode!==this)throw new DOMException(DOMException.NOT_FOUND_ERR)},DocumentFragment.prototype=new Node,this.DocumentFragment=DocumentFragment,Element.prototype=new Node,this.Element=Element,Element.prototype.initialize=function(namespaceURI,qname,ownerDocument){this.id="",this._setProtected("attributes",[]),this._setProtected("childNodes",[]),this._setProtected("ownerDocument",ownerDocument),this.__defineSetter__&&(this._nodeName=this.nodeName,this.__defineSetter__("nodeName",function(){throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR)}),this.__defineGetter__("nodeName",function(){return this._nodeName}),this.__defineSetter__("prefix",function(value){if(WARN_ON_PREFIX)throw"Setting prefix directly breaks integrity of the XML DOM in Internet Explorer browsers!";this._prefix=value,this._nodeName=this._prefix+this._localName}),this.__defineGetter__("prefix",function(){return this._prefix})),this._setProtected("namespaceURI",namespaceURI);if(qname.indexOf(":")>-1){var tup=qname.split(":");this.setPrefix(tup.shift()),this._setProtected("localName",tup.join(":"))}else this.setPrefix(null),this._setProtected("localName",qname);this.prefix?this._setProtected("nodeName",this.prefix+":"+this.localName):this._setProtected("nodeName",this.localName)},Element.prototype.toString=function(){return'<Element "'+this.nodeName+'" (type '+this.nodeType+")>"},Element.prototype.toXML=function(context){var no_prefix_id="::no_prefix::";context||(context={namespace_stack:[]});var new_namespaces={},current_namespaces={},last_namespaces=context.namespace_stack[context.namespace_stack.length-1];context.namespace_stack.push(current_namespaces);if(last_namespaces)for(var prefix in last_namespaces)current_namespaces[prefix]=last_namespaces[prefix];var xml="<"+this.nodeName,prefix=this.prefix||no_prefix_id;this.namespaceURI&&current_namespaces[prefix]!=this.namespaceURI&&(current_namespaces[prefix]=this.namespaceURI,new_namespaces[prefix]=this.namespaceURI);for(var i=0;i<this.attributes.length;i++){var attr=this.attributes[i],aprefix=attr.prefix||no_prefix_id;attr.namespaceURI&&current_namespaces[aprefix]!=attr.namespaceURI&&(current_namespaces[aprefix]=attr.namespaceURI,new_namespaces[aprefix]=attr.namespaceURI),xml+=" "+attr.nodeName+'="'+string.entitize(attr.nodeValue)+'"'}for(var prefix in new_namespaces)xml+=" xmlns",prefix!=no_prefix_id&&(xml+=":"+prefix),xml+='="'+string.entitize(new_namespaces[prefix])+'"';if(this.childNodes.length){xml+=">";for(var i=0;i<this.childNodes.length;i++)xml+=this.childNodes[i].toXML(context);xml+="</"+this.nodeName+">"}else xml+=" />";return context.namespace_stack.pop(),xml},Element.prototype.cloneNode=function(deep){var el=new Element;el.initialize(this.namespaceURI,this.nodeName,this.ownerDocument);for(var i=0;i<this.attributes.length;i++){var clone=this.attributes[i].cloneNode();clone._setProtected("ownerElement",el),el.attributes.push(clone)}if(deep)for(var i=0;i<this.childNodes.length;i++){var clone=this.childNodes[i].cloneNode(!0);clone._setProtected("parentNode",el),el.appendChild(clone)}return el},Element.prototype.getAttributeNodeNS=function(namespaceURI,qname){for(var i=0;i<this.attributes.length;i++){var attr=this.attributes[i];if(attr.namespaceURI==namespaceURI&&attr.nodeName==qname)return attr}},Element.prototype.getAttributeNode=function(name){return this.getAttributeNodeNS(undefined,name)},Element.prototype.getAttribute=function(name){var attr=this.getAttributeNode(name);return attr?attr.nodeValue:null},Element.prototype.getAttributeNS=function(namespaceURI,name){var attr=this.getAttributeNodeNS(namespaceURI,name);return attr?attr.nodeValue:null},Element.prototype.hasAttributeNS=function(namespaceURI,name){return!!this.getAttributeNS(namespaceURI,name)},Element.prototype.hasAttribute=function(name){return this.hasAttributeNS(this.namespaceURI,name)},Element.prototype.setAttributeNS=function(namespaceURI,name,value){for(var i=0;i<this.attributes.length;i++){var attr=this.attributes[i];if(attr.namespaceURI==namespaceURI&&attr.nodeName==name){attr.nodeValue=value;return}}var attr=new Attribute;attr.initialize(namespaceURI,name,value,this.ownerDocument),attr._setProtected("ownerElement",this),this.attributes.push(attr)},Element.prototype.setAttribute=function(name,value){this.setAttributeNS(undefined,name,value)},Element.prototype.setAttributeNodeNS=function(newAttr){for(var i=0;i<this.attributes.length;i++){var attr=this.attributes[i];if(attr.namespaceURI==newAttr.namespaceURI&&attr.nodeName==newAttr.nodeName)throw new DOMException(DOMException.INUSE_ATTRIBUTE_ERR)}this.attributes.push(newAttr)},Element.prototype.setAttributeNode=function(newAttr){this.setAttributeNodeNS(newAttr)},Element.prototype.removeAttributeNS=function(namespaceURI,name){for(var i=0;i<this.attributes.length;i++){var attr=this.attributes[i];if(attr.namespaceURI==namespaceURI&&attr.nodeName==name)return delete this.attributes[i],!0}return!1},Element.prototype.removeAttribute=function(name){return this.removeAttributeNS(this.namespaceURI,name)},Element.prototype.getElementsByTagNameNS=function(namespaceURI,name,ret){ret||(ret=[]);for(var i=0;i<this.childNodes.length;i++){var child=this.childNodes[i];(name==child.nodeName||name=="*")&&(!namespaceURI&&!child.namespaceURI||namespaceURI==child.namespaceURI)&&ret.push(child),child.nodeType==1&&child.getElementsByTagNameNS(namespaceURI,name,ret)}return ret},Element.prototype.getElementsByTagName=function(name){return this.getElementsByTagNameNS(this.namespaceURI,name)},Element.prototype.getElementById=function(id){if(this.id==id)return this;for(var i=0;i<this.childNodes.length;i++){var child=this.childNodes[i];if(child.id==id)return child;if(child.nodeType==1){var found=this.childNodes[i].getElementById(id);if(found)return found}}},TextNode.prototype=new Node,this.TextNode=TextNode,TextNode.prototype.initialize=function(data,ownerDocument){this._setProtected("ownerDocument",ownerDocument),this._setProtected("childNodes",new NodeList),this.nodeValue=data},TextNode.prototype.toXML=function(){return string.entitize(this.nodeValue)},TextNode.prototype.cloneNode=function(){var node=new TextNode;return node.initialize(this.nodeValue,this.ownerDocument),node},CommentNode.prototype=new TextNode,this.CommentNode=CommentNode,CommentNode.prototype.initialize=function(data,ownerDocument){this._setProtected("ownerDocument",ownerDocument),this._setProtected("childNodes",[]),this._setProtected("nodeValue",data)},CommentNode.prototype.toXML=function(){return"<!--"+this.nodeValue+"-->"},Attribute.prototype=new Node,this.Attribute=Attribute,Attribute.prototype.initialize=function(namespaceURI,qname,value,ownerDocument){if(qname.match(/[^a-zA-Z0-9_\-:]/g))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);this._setProtected("ownerDocument",ownerDocument),this._setProtected("namespaceURI",namespaceURI),this._setProtected("nodeValue",value),this._setProtected("childNodes",[]),this.__defineSetter__&&(this._nodeName=this.nodeName,this.__defineSetter__("nodeName",function(){throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR)}),this.__defineGetter__("nodeName",function(){return this._nodeName}),this.__defineSetter__("prefix",function(value){if(WARN_ON_PREFIX)throw"Setting prefix directly breaks integrity of the XML DOM in Internet Explorer browsers!";this._prefix=value,this._nodeName=this._prefix+this._localName}),this.__defineGetter__("prefix",function(){return this._prefix}),this._protectAttribute("ownerElement")),this._setProtected("ownerElement",null);if(qname.indexOf(":")>-1){var tup=qname.split(":");this.setPrefix(tup.shift()),this._setProtected("localName",tup.join(":"))}else this.setPrefix(null),this._setProtected("localName",qname);this.prefix?this._setProtected("nodeName",this.prefix+":"+this.localName):this._setProtected("nodeName",this.localName)},Attribute.prototype.toXML=function(){return ret=this.nodeName+'="'+string.entitize(this.nodeValue)+'"',ret},Attribute.prototype.cloneNode=function(){var attr=new Attribute;return attr.initialize(this.namespaceURI,this.nodeName,this.nodeValue,this.ownerDocument),attr},Attribute.prototype.toString=function(){return this.nodeValue},Document.prototype=new Node,this.Document=Document,Document.prototype.initialize=function(){this._setProtected("ownerDocument",this),this._setProtected("childNodes",[]),this.documentElement=null,this.namespaceToPrefix={}},Document.prototype.toXML=function(){return this.documentElement.toXML()},Document.prototype.appendChild=function(newChild){if(this.documentElement)throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,"document already has a document element");this._checkModificationAllowed(),this._attach(newChild),this.documentElement=newChild},Document.prototype.createElement=function(nodeName){return this.createElementNS(this.namespaceURI,nodeName)},Document.prototype.createElementNS=function(namespaceURI,nodeName){var el=new Element;return el.initialize(namespaceURI,nodeName,this),el},Document.prototype.createTextNode=function(data){var el=new TextNode;return el.initialize(string.deentitize(data),this),el},Document.prototype.createAttributeNS=function(namespaceURI,nodeName){var el=new Attribute;return el.initialize(namespaceURI,nodeName,null,this),el},Document.prototype.createAttribute=function(nodeName){return this.createAttributeNS(undefined,nodeName)},Document.prototype.createComment=function(data){var el=new CommentNode;return el.initialize(data,this),el},Document.prototype.importNode=function(node){node._setProtected("ownerDocument",this)},this.DOMHandler=DOMHandler,DOMHandler.prototype.startDocument=function(){this.document=new Document,this.document.initialize(),this.current=null,this.namespaces=new Array,this.namespaceToPrefix={}},DOMHandler.prototype.startElement=function(namespaceURI,nodename,attrs){namespaceURI&&!array.contains(this.namespaces,namespaceURI)&&(this.namespaces.push(namespaceURI),this.document.namespaceToPrefix=this.namespaceToPrefix);var node=this.document.createElementNS(namespaceURI,nodename),prefix=undefined;namespaceURI&&(prefix=this.namespaceToPrefix[namespaceURI],prefix&&node.setPrefix(prefix));for(var ans in attrs){ans&&ans!=""&&!array.contains(this.namespaces,ans)&&this.namespaces.push(ans);var nsattrs=attrs[ans];for(var aname in nsattrs){if(aname=="prefix")continue;if(ans){var attr=this.document.createAttributeNS(ans,aname);attr.setPrefix(this.namespaceToPrefix[ans]),attr.nodeValue=nsattrs[aname],node.setAttributeNodeNS(attr)}else{var attr=this.document.createAttribute(aname);attr.nodeValue=nsattrs[aname],node.setAttributeNode(attr)}}}this.current?(this.current.appendChild(node),this.current=node):(this.document.documentElement=node,this.document._setProtected("childNodes",[node]),this.current=node,this.current._setProtected("parentNode",this.document),this.current._setProtected("ownerDocument",this.document))},DOMHandler.prototype.characters=function(data){if(!this.current&&string.strip(data)=="")return;var node=this.document.createTextNode(data);this.current.appendChild(node)},DOMHandler.prototype.comment=function(data){if(!this.current&&string.strip(data)=="")return;var node=this.document.createComment(data);this.current?this.current.appendChild(node):this.document.comment=node},DOMHandler.prototype.endElement=function(namespaceURI,nodename){var prefix=this.namespaceToPrefix[namespaceURI];if(nodename!=this.current.localName||namespaceURI!=this.current.namespaceURI)throw"non-matching end tag "+namespaceURI+":"+prefix+":"+nodename+" for start tag "+this.current.namespaceURI+":"+this.current.nodeName;this.current=this.current.parentNode},DOMHandler.prototype.endDocument=function(){},this.DOM=DOM,DOM.prototype.createDocument=function(){var document=new Document;return document.initialize(),document},DOM.prototype.toXML=function(docOrEl,encoding){var xml='<?xml version="1.0"';return encoding&&(xml+=' encoding="'+encoding+'"'),xml+="?>\n",xml+docOrEl.toXML()},DOM.prototype.parseXML=function(xml){var handler=new DOMHandler,parser=new SAXParser;parser.initialize(xml,handler),parser.parse();var document=handler.document;return this._copyNamespaceMapping(document,handler.namespaceToPrefix),document},DOM.prototype.buildFromHandler=function(handler){var document=handler.document;return this._copyNamespaceMapping(document,handler.namespaceToPrefix),document},DOM.prototype._copyNamespaceMapping=function(document,namespaces){document.namespaceToPrefix=namespaces},BaseArray.prototype.concat=function(){throw"Not supported"},BaseArray.prototype.join=function(){throw"Not supported"},BaseArray.prototype.pop=function(){var item=this[this.length-1];return delete this[this.length-1],this.length=this.length-1,item},BaseArray.prototype.push=function(item){return this[this.length]=item,this.length=this.length+1,item},BaseArray.prototype.reverse=function(){throw"Not supported"},BaseArray.prototype.shift=function(){var item=this[0];for(var i=1;i<this.length;i++)this[i-1]=this[i];return delete this[length-1],this.length=this.length-1,item},BaseArray.prototype.unshift=function(item){for(var i=0;i<this.length;i++)this[this.length-i]=this[this.length-i-1];this[0]=item,this.length=this.length+1;return},BaseArray.prototype.splice=function(){throw"Not supported"},BaseArray.prototype.toString=function(){var ret=[];for(var i=1;i<this.length;i++)ret.push(this[i].toString());return ret.join(", ")},this.BaseArray=BaseArray,NodeList.prototype=new BaseArray,this.NodeList=NodeList,NodeList.prototype.item=function(index){return this[index]},NamedNodeMap.prototype=new BaseArray,this.NamedNodeMap=NamedNodeMap,NamedNodeMap.prototype.item=function(index){return this[index]},NamedNodeMap.prototype.getNamedItem=function(name){for(var i=0;i<this.length;i++)if(this[i].nodeName==name)return this[i];return undefined},NamedNodeMap.prototype.setNamedItem=function(arg){for(var i=0;i<this.length;i++)if(this[i].nodeName==arg.nodeName){this[i]=arg;return}this.push(arg)},NamedNodeMap.prototype.removeNamedItem=function(name){var delete_mode=!1;for(var i=0;i<this.length;i++)this[i]===name&&(delete_mode=!0),delete_mode&&(this[i]=this[i+1]);if(!delete_mode)throw new DOMException(DOMException.NOT_FOUND_ERR);this.pop()}},define("davDommer",function(){});var global=this;global.davlib=new function(){var davlib=this;this.DEBUG=0,this.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"None-Authoritive Information",204:"No Content",1223:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported",507:"Insufficient Storage"},this.DavClient=function(){},this.DavClient.prototype.initialize=function(host,port,protocol){this.host=host||location.hostname,this.port=port||location.port||80,this.protocol=protocol||location.protocol.substr(0,location.protocol.length-1)||"http",this.request=null},this.DavClient.prototype.OPTIONS=function(path,handler,context){var request=this._getRequest("OPTIONS",path,handler,context);request.send("")},this.DavClient.prototype.GET=function(path,handler,context){var request=this._getRequest("GET",path,handler,context);request.send("")},this.DavClient.prototype.PUT=function(path,content,handler,context,locktoken){var request=this._getRequest("PUT",path,handler,context);locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.send(content)},this.DavClient.prototype.DELETE=function(path,handler,context,locktoken){var request=this._getRequest("DELETE",path,handler,context);locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.send("")},this.DavClient.prototype.MKCOL=function(path,handler,context,locktoken){var request=this._getRequest("MKCOL",path,handler,context);locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.send("")},this.DavClient.prototype.COPY=function(path,topath,handler,context,overwrite,locktoken){var request=this._getRequest("COPY",path,handler,context),tourl=this._generateUrl(topath);request.setRequestHeader("Destination",tourl),overwrite&&request.setRequestHeader("Overwrite","F"),locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.send("")},this.DavClient.prototype.MOVE=function(path,topath,handler,context,overwrite,locktoken){var request=this._getRequest("MOVE",path,handler,context),tourl=this._generateUrl(topath);request.setRequestHeader("Destination",tourl),overwrite&&request.setRequestHeader("Overwrite","F"),locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.send("")},this.DavClient.prototype.PROPFIND=function(path,handler,context,depth){var request=this._getRequest("PROPFIND",path,handler,context);depth=depth||0,request.setRequestHeader("Depth",depth.toString()),request.setRequestHeader("Content-type","text/xml; charset=UTF-8");var xml='<?xml version="1.0" encoding="UTF-8" ?><D:propfind xmlns:D="DAV:"><D:allprop /></D:propfind>';request.send(xml)},this.DavClient.prototype.PROPPATCH=function(path,handler,context,setprops,delprops,locktoken){var request=this._getRequest("PROPPATCH",path,handler,context);request.setRequestHeader("Content-type","text/xml; charset=UTF-8"),locktoken&&request.setRequestHeader("If","<"+locktoken+">");var xml=this._getProppatchXml(setprops,delprops);request.send(xml)},this.DavClient.prototype.LOCK=function(path,owner,handler,context,scope,type,depth,timeout,locktoken){scope||(scope="exclusive"),type||(type="write");var request=this._getRequest("LOCK",path,handler,context);depth&&request.setRequestHeader("Depth",depth),timeout?timeout="Second-"+timeout:timeout="Infinite, Second-4100000000",locktoken&&request.setRequestHeader("If","<"+locktoken+">"),request.setRequestHeader("Content-Type","text/xml; charset=UTF-8"),request.setRequestHeader("Timeout",timeout);var xml=this._getLockXml(owner,scope,type);request.send(xml)},this.DavClient.prototype.UNLOCK=function(path,locktoken,handler,context){var request=this._getRequest("UNLOCK",path,handler,context);request.setRequestHeader("Lock-Token","<"+locktoken+">"),request.send("")},this.DavClient.prototype._getRequest=function(method,path,handler,context){var request=davlib.getXmlHttpRequest();method=="LOCK"?request.onreadystatechange=this._wrapLockHandler(handler,request,context):request.onreadystatechange=this._wrapHandler(handler,request,context);var url=this._generateUrl(path);return request.open(method,url,!0),request},this.DavClient.prototype._wrapHandler=function(handler,request,context){function HandlerWrapper(){this.execute=function(){if(request.readyState==4){var status=request.status.toString(),headersString=request.getResponseHeaders();headersString?headersString=headersString.join("\n"):headersString=request.getAllResponseHeaders();var headers=self._parseHeaders(headersString),content=request.responseText;status=="207"&&(content=self._parseMultiStatus(content));var statusstring=davlib.STATUS_CODES[status];handler.call(context,status,statusstring,content,headers)}}}var self=this;return(new HandlerWrapper).execute},this.DavClient.prototype._wrapLockHandler=function(handler,request,context){function HandlerWrapper(){this.execute=function(){if(request.readyState==4){var status=request.status.toString(),headers=self._parseHeaders(request.getAllResponseHeaders()),content=request.responseText;status=="200"?content=self._parseLockinfo(content):status=="207"&&(content=self._parseMultiStatus(content));var statusstring=davlib.STATUS_CODES[status];handler.call(context,status,statusstring,content,headers)}}}var self=this;return(new HandlerWrapper).execute},this.DavClient.prototype._generateUrl=function(path){if(path.indexOf("http")===0)return path;var url=this.protocol+"://"+this.host;return url+=path,url},this.DavClient.prototype._parseMultiStatus=function(xml){var handler=new davlib.MultiStatusSAXHandler,parser=new SAXParser;return parser.initialize(xml,handler),parser.parse(),handler.root},this.DavClient.prototype._parseLockinfo=function(xml){var handler=new davlib.LockinfoSAXHandler,parser=new SAXParser;return parser.initialize(xml,handler),parser.parse(),handler.lockInfo},this.DavClient.prototype._getProppatchXml=function(setprops,delprops){var xml='<?xml version="1.0" encoding="UTF-8" ?>\n<D:propertyupdate xmlns:D="DAV:">\n',shouldsetprops=!1;for(var attr in setprops)shouldsetprops=!0;if(shouldsetprops){xml+="<D:set>\n";for(var ns in setprops)for(var key in setprops[ns])xml+="<D:prop>\n"+this._preparePropElement(ns,key,setprops[ns][key])+"</D:prop>\n";xml+="</D:set>\n"}var shoulddelprops=!1;for(var attr in delprops)shoulddelprops=!0;if(shoulddelprops){xml+="<D:remove>\n<D:prop>\n";for(var ns in delprops)for(var i=0;i<delprops[ns].length;i++)xml+="<"+delprops[ns][i]+' xmlns="'+ns+'"/>\n';xml+="</D:prop>n</D:remove>\n"}return xml+="</D:propertyupdate>",xml},this.DavClient.prototype._getLockXml=function(owner,scope,type){var xml='<?xml version="1.0" encoding="utf-8"?>\n<D:lockinfo xmlns:D="DAV:">\n<D:lockscope><D:'+scope+" /></D:lockscope>\n"+"<D:locktype><D:"+type+" /></D:locktype>\n"+"<D:owner>\n<D:href>"+string.entitize(owner)+"</D:href>\n</D:owner>\n"+"</D:lockinfo>\n";return xml},this.DavClient.prototype._preparePropElement=function(ns,key,value){var dom=new dommer.DOM,doc=dom.parseXML(value);return doc.documentElement.toXML()},this.DavClient.prototype._parseHeaders=function(headerstring){var lines=headerstring.split("\n"),headers={};for(var i=0;i<lines.length;i++){var line=string.strip(lines[i]);if(!line)continue;var chunks=line.split(":"),key=string.strip(chunks.shift()),value=string.strip(chunks.join(":")),lkey=key.toLowerCase();headers[lkey]!==undefined?headers[lkey].push?headers[lkey].push(value):headers[lkey]=[headers[lkey,value]]:headers[lkey]=value}return headers},this.Resource=function(href,props){this.items=[],this.parent,this.properties={}},this.Root=function(){},this.Root.prototype=new this.Resource,this.MultiStatusSAXHandler=function(){},this.MultiStatusSAXHandler.prototype=new SAXHandler,this.MultiStatusSAXHandler.prototype.startDocument=function(){this.resources=[],this.depth=0,this.current=null,this.current_node=null,this.current_prop_namespace=null,this.current_prop_name=null,this.current_prop_handler=null,this.prop_start_depth=null,this.elements=[]},this.MultiStatusSAXHandler.prototype.endDocument=function(){this.buildTree()},this.MultiStatusSAXHandler.prototype.startElement=function(namespace,nodeName,attributes){this.depth++,this.elements.push([namespace,nodeName]),davlib.debug("start: "+namespace+":"+nodeName),davlib.debug("parent: "+(this.elements.length?this.elements[this.elements.length-2]:""));if(this.current_node=="property"){this.current_prop_handler.startElement(namespace,nodeName,attributes);return}if(namespace=="DAV:"&&nodeName=="response"){var resource=new davlib.Resource;this.current&&(resource.parent=this.current),this.current=resource,this.resources.push(resource)}else{var parent=this.elements[this.elements.length-2];if(!parent)return;namespace=="DAV:"&&parent[0]=="DAV:"&&parent[1]=="response"||parent[1]=="propstat"?nodeName=="href"?this.current_node="href":nodeName=="status"&&(this.current_node="status"):parent[0]=="DAV:"&&parent[1]=="prop"&&(this.current_node="property",this.current_prop_namespace=namespace,this.current_prop_name=nodeName,this.current_prop_handler=new dommer.DOMHandler,this.current_prop_handler.startDocument(),this.current_prop_handler.startElement(namespace,nodeName,attributes),this.start_prop_depth=this.depth,davlib.debug("start property"))}},this.MultiStatusSAXHandler.prototype.endElement=function(namespace,nodeName){davlib.debug("end: "+namespace+":"+nodeName);if(namespace=="DAV:"&&nodeName=="response")this.current&&(this.current=this.current.parent);else if(this.current_node=="property"&&namespace==this.current_prop_namespace&&nodeName==this.current_prop_name&&this.start_prop_depth==this.depth){davlib.debug("end property"),this.current_prop_handler.endElement(namespace,nodeName),this.current_prop_handler.endDocument();var dom=new dommer.DOM,doc=dom.buildFromHandler(this.current_prop_handler);this.current.properties[namespace]||(this.current.properties[namespace]={}),this.current.properties[namespace][this.current_prop_name]=doc,this.current_prop_namespace=null,this.current_prop_name=null,this.current_prop_handler=null}else if(this.current_node=="property"){this.current_prop_handler.endElement(namespace,nodeName),this.depth--,this.elements.pop();return}this.current_node=null,this.elements.pop(),this.depth--},this.MultiStatusSAXHandler.prototype.characters=function(data){this.current_node&&(this.current_node=="status"?this.current[this.current_node]=data.split(" ")[1]:this.current_node=="href"?this.current[this.current_node]=data:this.current_node=="property"&&this.current_prop_handler.characters(data))},this.MultiStatusSAXHandler.prototype.buildTree=function(){var minlen=-1,root,rootpath;for(var i=0;i<this.resources.length;i++){var resource=this.resources[i];resource.path=resource.href.split("/"),resource.path[resource.path.length-1]==""&&resource.path.pop();var len=resource.path.length;if(minlen==-1||len<minlen)minlen=len,root=resource,root.parent=null}var elements=[];for(var i=0;i<this.resources.length;i++){var resource=this.resources[i];if(resource==root)continue;elements.push(resource)}while(elements.length){var leftovers=[];for(var i=0;i<elements.length;i++){var resource=elements[i],path=resource.path,current=root;if(path.length==root.path.length+1)root.items.push(resource),resource.parent=root;else{for(var j=root.path.length;j<path.length-1;j++)for(var k=0;k<current.items.length;k++){var item=current.items[k];if(item.path[item.path.length-1]==path[j]){j==path.length-2?(item.items.push(resource),resource.parent=item):current=item;break}}leftovers.push(resource)}}elements=leftovers}this.root=root},this.LockinfoSAXHandler=function(){},this.LockinfoSAXHandler.prototype=new SAXHandler,this.LockinfoSAXHandler.prototype.startDocument=function(){this.lockInfo={},this.currentItem=null,this.insideHref=!1},this.LockinfoSAXHandler.prototype.startElement=function(namespace,nodeName,attributes){namespace=="DAV:"&&(nodeName=="locktype"||nodeName=="lockscope"||nodeName=="depth"||nodeName=="timeout"||nodeName=="owner"||nodeName=="locktoken"?this.currentItem=nodeName:nodeName=="href"&&(this.insideHref=!0))},this.LockinfoSAXHandler.prototype.endElement=function(namespace,nodeName){namespace=="DAV:"&&(nodeName=="href"?this.insideHref=!1:this.currentItem=null)},this.LockinfoSAXHandler.prototype.characters=function(data){this.currentItem&&(this.currentItem!="owner"||this.insideHref)&&(this.currentItem!="locktoken"||this.insideHref)&&(this.lockInfo[this.currentItem]=data)},this.getXmlHttpRequest=function(){try{return console.log("Trying Titanium..."),Titanium.Network.createHTTPClient()}catch(e){console.log("FAIL!!!")}try{return console.log("Trying xhr..."),new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw alert("Your browser does not support XMLHttpRequest, required for WebDAV access."),"Browser not supported"},this.debug=function(text){if(!davlib.DEBUG)return;var div=document.createElement("div"),text=document.createTextNode(text);div.appendChild(text),document.getElementsByTagName("body")[0].appendChild(div)}},define("davClient",function(){});var global=this;if(!global.davlib){alert("Error: davclient.js needs to be loaded before davfs.js");try{var exc=new exception.MissingDependency("davclient.js","davfs.js")}catch(e){var exc="Missing Dependency: davclient.js (from davfs.js)"}throw exc}davlib.ResourceCache=function(){},davlib.ResourceCache.prototype.initialize=function(){this._cache={}},davlib.ResourceCache.prototype.addResource=function(path,resource){this._cache[path]=resource},davlib.ResourceCache.prototype.getResource=function(path){return this._cache[path]},davlib.ResourceCache.prototype.invalidate=function(path){delete this._cache[path]},davlib.DavFS=function(){},davlib.DavFS.prototype.initialize=function(host,port,protocol){this._client=new davlib.DavClient,this._client.initialize(host,port,protocol),this._cache=new davlib.ResourceCache,this._cache.initialize()},davlib.DavFS.prototype.read=function(path,handler,context){this._client.GET(path,this._wrapHandler(handler,this._prepareArgsRead,context),this)},davlib.DavFS.prototype.write=function(path,content,handler,context,locktoken){this._client.PUT(path,content,this._wrapHandler(handler,this._prepareArgsSimpleError,context),this,locktoken)},davlib.DavFS.prototype.remove=function(path,handler,context,locktoken){this._client.DELETE(path,this._wrapHandler(handler,this._prepareArgsMultiError,context),this,locktoken)},davlib.DavFS.prototype.mkDir=function(path,handler,context,locktoken){this._client.MKCOL(path,this._wrapHandler(handler,this._prepareArgsSimpleError,context),this,locktoken)},davlib.DavFS.prototype.copy=function(path,topath,handler,context,overwrite,locktoken){this._client.COPY(path,topath,this._wrapHandler(handler,this._prepareArgsMultiError,context),this,overwrite,locktoken)},davlib.DavFS.prototype.move=function(path,topath,handler,context,locktoken){this._client.MOVE(path,topath,this._wrapHandler(handler,this._prepareArgsMultiError,context),this,locktoken)},davlib.DavFS.prototype.listDir=function(path,handler,context,cached){if(cached){var item=this._cache.getResource(path);if(item&&item.items.length>0){var dir=[];for(var i=0;i<item.items.length;i++)dir.push(item.items[i].href);handler.apply("200",dir);return}}this._client.PROPFIND(path,this._wrapHandler(handler,this._prepareArgsListDir,context),this,1)},davlib.DavFS.prototype.getProps=function(path,handler,context,cached){if(cached){var item=this._cache.getResource(path);if(item){timer_instance.registerFunction(context,handler,0,null,item.properties);return}}this._client.PROPFIND(path,this._wrapHandler(handler,this._prepareArgsGetProps,context),this,0)},davlib.DavFS.prototype.setProps=function(path,setprops,delprops,handler,context,locktoken){this._client.PROPPATCH(path,this._wrapHandler(handler,this._prepareArgsMultiError,context),this,setprops,delprops,locktoken)},davlib.DavFS.prototype.lock=function(path,owner,handler,context,scope,type,depth,timeout,locktoken){this._client.LOCK(path,owner,this._wrapHandlerLock(handler,this._prepareArgsMultiError,context),this,scope,depth,timeout,locktoken)},davlib.DavFS.prototype.unlock=function(path,locktoken,handler,context){this._client.UNLOCK(path,locktoken,this._wrapHandler(handler,this._prepareArgsMultiError,context),this)},davlib.DavFS.prototype.isLocked=function(path,handler,context,cached){function sub(error,content){if(!error){var ns=content["DAV:"];!ns||!ns.lockdiscovery||!ns.lockdiscovery.documentElement.getElementsByTagName("activelock").length?content=!1:content=!0,handler(error,content)}}this.getProps(path,sub,context,cached)},davlib.DavFS.prototype._prepareArgsRead=function(status,statusstring,content){var error;return status!="200"&&status!="201"&&status!="204"&&(error=statusstring),[error,content]},davlib.DavFS.prototype._prepareArgsSimpleError=function(status,statusstring,content){var error;return status!="200"&&status!="201"&&status!="204"&&status!="1223"&&(error=statusstring),[error]},davlib.DavFS.prototype._prepareArgsMultiError=function(status,statusstring,content){var error=null;return status=="207"?(error=this._getErrorsFromMultiStatusTree(content),error.length||(error=null)):status!="200"&&status!="201"&&status!="204"&&(error=statusstring),[error]},davlib.DavFS.prototype._prepareArgsListDir=function(status,statusstring,content){var error;if(status=="207"){error=this._getErrorsFromMultiStatusTree(content);if(error.length==0){error=undefined,this._cache.addResource(content.href,content);for(var i=0;i<content.items.length;i++){var child=content.items[i];this._cache.addResource(child.href,child)}}}else status!="200"&&status!="201"&&status!="204"&&(error=statusstring);return[error,content]},davlib.DavFS.prototype._prepareArgsGetProps=function(status,statusstring,content){var error;return status=="207"?(error=this._getErrorsFromMultiStatusTree(content),error.length==0&&(error=undefined,this._cache.addResource(content.href,content),content=content.properties)):status!="200"&&status!="201"&&status!="204"&&(error=statusstring),[error,content]},davlib.DavFS.prototype._wrapHandler=function(handler,prepareargs,context){function sub(status,statusstring,content){var args=prepareargs.call(this,status,statusstring,content);handler.apply(context,args)}return sub},davlib.DavFS.prototype._wrapHandlerLock=function(handler,prepareargs,context){function sub(status,statusstring,content){var error;status=="207"?(error=this._getErrorsFromMultiStatusTree(content),error.length==0&&(error=undefined,this._cache.addResource(content.href,content),content=content.properties)):status!="200"?error=statusstring:content=content.locktoken,handler.apply(context,[error,content])}return sub},davlib.DavFS.prototype._getErrorsFromMultiStatusTree=function(curritem){var errors=[],status=curritem.status;status&&status!="200"&&status!="204"&&errors.push(STATUS_CODES[status]);for(var i=0;i<curritem.items.length;i++){var itemerrors=this._getErrorsFromMultiStatusTree(curritem.items[i]);if(itemerrors)for(var j=0;j<itemerrors.length;j++)errors.push(itemerrors[j])}return errors},davlib.DavFS.prototype._getDirFromMultiStatusTree=function(root){var list=[];this._cache.addResource(root.href,root);for(var i=0;i<root.items.length;i++){var item=root.items[i];list.push(item.href)}return list.sort(),list},define("davlib",["davException","davString","davArray","davMinisax","davDommer","davClient"],function(global){return function(){return global.Davlib}}(this)),define("fileDescriptor",[],function(){var FileDescriptor=function(){this.name=null,this.path=null,this.relativePath=null,this.createTimestamp=null,this.lastTimestamp=null,this.size=0,this.isDir=!1;var self=this;this.readSize=function(size){var info=size||self.size;info=info||0;var units=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=0;while(info>=1024)info/=1024,++i;return info.toFixed(1)+" "+units[i]}};return FileDescriptor}),define("davFSAdapter",["underscore","davlib","fileDescriptor"],function(_,Davlib,FileDescriptor){var DavFSAdapter=function(){console.log("DavFSAdapter")};return _.extend(DavFSAdapter.prototype,{initialize:function(host,port,protocol){this.fs=new davlib.DavFS,this.fs.initialize(host,port,protocol),this.basePath=protocol+"://"+host+":"+port,this.sep="/"},getFullPath:function(path){return this.basePath+path},readdir:function(path,callback){this.recursionDepth=-1,this.treeContent=[],this.callback=callback,this.queryPath=path,this._readdir(path)},copy:function(path,topath,callback){this.callback=callback,this.fs.copy(path,topath,this._actionCallback,this)},write:function(path,content,callback){this.callback=callback,this.fs.write(path,content,this._actionCallback,this)},read:function(path,callback){this.callback=callback,this.fs.read(path,this._actionCallback,this)},mkdir:function(path,callback){this.callback=callback,path=this._extractDir(path),this.pathToBuild=path,this.fs.listDir(path,this._createDir,this)},isDir:function(path,callback){path=this._extractDir(path),this.callback=callback,this.fs.listDir(path,this._isDirCallback,this)},_isDirCallback:function(error,content){this.callback(!error)},_extractDir:function(path){var lastSep=path.lastIndexOf(this.sep);return lastSep<path.length&&(path=path.substr(0,lastSep+1)),path=path.replace(this.basePath,""),path},_createDir:function(error,content){if(!error){this._actionCallback();return}this.pathSegments=this.pathToBuild.split(this.sep),console.log("Path to build: "+this.pathSegments.join()),this.currentSegment=this.sep,this._checkNextSegment()},_checkNextSegment:function(error,content){error?console.log("ERROR creating "+this.currentSegment):this.currentSegment&&console.log("SUCCESS creating "+this.currentSegment);if(this.pathSegments.length===0){this._actionCallback(arguments[0]);return}this.currentSegment+=this.pathSegments.shift()+this.sep,console.log("segment to check:"+this.currentSegment),this.fs.listDir(this.currentSegment,this._createNextSegment,this)},_createNextSegment:function(error,content){error&&console.log("segment check error: "+this.currentSegment+" =>"+error);if(!error){this._checkNextSegment();return}console.log("segment to build:"+this.currentSegment);var self=this;this.fs.mkDir(this.currentSegment,this._checkNextSegment,this)},rm:function(path,callback){this.rmdir(path,callback)},rmdir:function(path,callback){this.callback=callback,this.fs.remove(path,this._rmdirCallback,this)},_rmdirCallback:function(err){err?this.callback(err):this.callback(null,"OK")},_actionCallback:function(err,content){if(err)this.callback(err);else{var success=content?content:"OK";this.callback(null,success)}},_readdir:function(path){this.recursionDepth++,this.fs.listDir(path,this._explore,this)},_explore:function(error,content){if(error){this.callback(error);return}var self=this;_.each(content.items,function(data){var info=self._parse(data);self._filter(info.name)||(self.treeContent.push(info),info.isDir&&self._readdir(info.path))}),this.recursionDepth--===0&&this.callback(null,this.treeContent)},_filter:function(name){return name===".DS_Store"||name===".Thumbs.db"},_parse:function(data){var davInfo=data.properties["DAV:"],fd=new FileDescriptor;return fd.name=data.path.pop(),fd.path=data.href,fd.relativePath=fd.path.replace(this.queryPath,""),fd.createTimestamp=this._parseCreationDate(davInfo.creationdate.childNodes[0].childNodes[0].nodeValue),fd.lastTimestamp=this._parseLastModified(davInfo.getlastmodified.childNodes[0].childNodes[0].nodeValue),fd.size=davInfo.getcontentlength?Number(davInfo.getcontentlength.childNodes[0].childNodes[0].nodeValue):null,fd.isDir=davInfo.resourcetype.childNodes[0].childNodes.length!==0?!0:!1,fd},_parseCreationDate:function(creationDate){var d=creationDate.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z/),timestamp=(new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])).getTime();return timestamp},_parseLastModified:function(lastModified){var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=lastModified.match(/.+(\d{2}) (\w{3}) (\d{4}) (\d{2}):(\d{2}):(\d{2}) GMT/),timestamp=(new Date(d[3],month.indexOf(d[2]),d[1],d[4],d[5],d[6])).getTime();return timestamp}}),DavFSAdapter}),define("localFSAdapter",["underscore","fileDescriptor"],function(_,FileDescriptor){var LocalFsAdapter=function(){console.log("LocalFsAdapter")};return _.extend(LocalFsAdapter.prototype,{initialize:function(baseDir){this.enabled=typeof Titanium!="undefined";if(!this.enabled){console.log("error: Titanium is not enabled");return}this.baseDir=baseDir||"",this.homeDir=this.getHomeDir(),this.workingDir=Titanium.Filesystem.getFile(this.homeDir,this.baseDir),this.sep=Titanium.Filesystem.getSeparator(),this.workingDir.exists()||this.workingDir.createDirectory()},getHomeDir:function(){if(Titanium.Platform.getName()=="Darwin")return Titanium.Filesystem.getDocumentsDirectory();var tmp=Titanium.Filesystem.getDocumentsDirectory();return tmp=tmp.nativePath(),Titanium.Filesystem.getFile(tmp)},getFullPath:function(path){return path},isDir:function(path,callback){path=this._extractDir(this._normalizePath(path));var dir=Titanium.Filesystem.getFile(this.workingDir,path);callback(dir.isDirectory())},readdir:function(path,callback){this.callback=callback,this.queryPath=this._normalizePath(path),this.treeContent=[],this.recursionDepth=-1,readpath=Titanium.Filesystem.getFile(this.homeDir,path||this.baseDir);if(!readpath.isDirectory){console.log(readpath.toString()+" not a directory"),this.callback("Not Found");return}this._readdir(path)},copy:function(path,topath,callback){this.callback=callback;try{this.callback=callback;var src=Titanium.Filesystem.getFile(this.workingDir,path),dest=Titanium.Filesystem.getFile(this.workingDir,topath);src.copy(dest),this._actionCallback()}catch(err){this._actionCallback("cannot copy "+path+"to "+topath+". err: "+err)}},append:function(path,content,callback){this._write(path,content,callback,Titanium.Filesystem.MODE_APPEND)},write:function(path,content,callback){this._write(path,content,callback,Titanium.Filesystem.MODE_WRITE)},_extractDir:function(path){var lastSep=path.lastIndexOf(this.sep);return lastSep<path.length&&(path=path.substr(0,lastSep+1)),path},_write:function(path,content,callback,mode){this.callback=callback;try{var file=Titanium.Filesystem.getFile(this.workingDir,path);if(!file.parent().isDirectory()){var self=this;this.mkdir(this._extractDir(path),function(){self.callback=callback;return})}var fileStream=file.open(mode);fileStream.write(content),fileStream.close(),this._actionCallback()}catch(err){this._actionCallback("cannot write. err: "+err)}},read:function(path,callback){this.callback=callback;try{var fileStream=Titanium.Filesystem.getFileStream(this.workingDir,path);fileStream.open(Titanium.Filesystem.MODE_READ);var content=fileStream.read();fileStream.close(),this.callback(null,content)}catch(err){this._actionCallback("cannot read "+path+". err: "+err.message)}},_normalizePath:function(path){return Titanium.Platform.getName()!=="Darwin"&&(path=path.replace(/\//g,Titanium.Filesystem.getSeparator())),path},mkdir:function(path,callback){this.callback=callback,path=this._extractDir(this._normalizePath(path));try{var dir=Titanium.Filesystem.getFile(this.workingDir,path);if(!dir.exists()){var dir_path=this.workingDir.toString(),path_arr=_.compact(path.toString().split(this.sep)),sep=this.sep;_.each(path_arr,function(p){var d=Titanium.Filesystem.getFile(dir_path+sep+p);d.exists()||d.createDirectory(),dir_path=d.toString()})}this._actionCallback()}catch(err){this._actionCallback("cannot create "+path+". err: "+err.message)}},rm:function(path,callback){this.callback=callback;try{var file=Titanium.Filesystem.getFile(this.workingDir,path),result=file.deleteFile();return result?this._actionCallback():this._actionCallback("cannot delete "+path)}catch(err){this._actionCallback("cannot delete "+path+". err: "+err.message)}},rmdir:function(path,callback){this.callback=callback;try{var file=Titanium.Filesystem.getFile(this.workingDir,path),result=file.deleteDirectory(!0);return result?this._actionCallback():this._actionCallback("cannot delete "+path)}catch(err){this._actionCallback("cannot delete "+path+". err: "+err.message)}},_actionCallback:function(err){err?this.callback(err):this.callback(null,"OK")},_readdir:function(path){this.recursionDepth++,path=Titanium.Filesystem.getFile(this.homeDir,path||this.baseDir);var content=path.getDirectoryListing();this._explore(content)},_explore:function(content){if(!content){this.callback("Not Found");return}var self=this;_.each(content,function(data){var info=self._parse(data);self._filter(info.name)||(self.treeContent.push(info),info.isDir&&self._readdir(info.path))}),this.recursionDepth--===0&&this.callback(null,this.treeContent)},_filter:function(name){return name===".DS_Store"||name===".Thumbs.db"||name===".ignore"},_parse:function(data){var fd=new FileDescriptor;return fd.name=data.name(),fd.path=data.nativePath().replace(this.homeDir.nativePath(),""),fd.createTimestamp=this._parseTimestamp(data.createTimestamp()),fd.lastTimestamp=this._parseTimestamp(data.modificationTimestamp()),fd.isDir=data.isDirectory(),fd.size=fd.isDir?null:data.size(),fd.isDir&&(fd.path+=this.sep),fd.relativePath=fd.path.replace(this.queryPath,""),fd},_parseTimestamp:function(timestamp){return(new Date(timestamp/1e3+(new Date).getTimezoneOffset()*6e4)).getTime()}}),LocalFsAdapter}),define("shipper",["underscore"],function(_){var Shipper=function(baseDir,logger){this.baseDir=baseDir||"",this.homeDir=Titanium.Filesystem.getDocumentsDirectory(),this.workingDir=Titanium.Filesystem.getFile(this.homeDir,this.baseDir),this.logger=logger};return _.extend(Shipper.prototype,{transfer:function(paths,callbacks){this.origin=paths.origin,this.destination=paths.destination,this.callbacks=callbacks,this._processTransfer()},_processTransfer:function(error){this.origin.indexOf("http")===0?this.download(this.origin,this.destination,this.callbacks):this.upload(this.origin,this.destination,this.callbacks)},download:function(src,dest,callbacks){this._initCallbacks(callbacks);var url=src,filePath=this.workingDir+dest;Titanium.Platform.getName()!=="Darwin"&&(filePath=filePath.replace(/\//g,Titanium.Filesystem.getSeparator()));var httpClient=Titanium.Network.createHTTPClient(),self=this;httpClient.onreadystatechange=function(e){e.readyState==4&&self._onComplete("download","download done")},httpClient.ondatastream=function(e){length=e.getResponseHeader("Content-Length"),httpClient.ondatastream=null,!(length>0),console.log("#####ONRECEIVESTREAM - PROGRESS: "+e.dataReceived)},httpClient.onerror=function(e){self._onError(e)};if(httpClient.open("GET",url)){var file=Titanium.Filesystem.createTempFile();file.copy(filePath),httpClient.xFile=filePath,httpClient.receive(function(data){var file=Titanium.Filesystem.getFile(this.xFile),fileStream=file.open(Titanium.Filesystem.MODE_APPEND);fileStream.write(data),fileStream.close()})}else self._onError(e)},upload:function(src,dest,callbacks){this._initCallbacks(callbacks),console.log(src+"=>"+dest);var self=this,file=Titanium.Filesystem.getFile(this.workingDir+src);if(!file.exists()){this._onError("upload","path not found"+file),console.log("path not found:"+file);return}var content=Titanium.API.createBytes();if(file.size()>0){var uploadStream=Titanium.Filesystem.getFileStream(file);uploadStream.open(Titanium.Filesystem.MODE_READ),content=uploadStream.read(),uploadStream.close()}var xhr=Titanium.Network.createHTTPClient();xhr.addEventListener(Titanium.HTTP_DONE,function(){console.log("TI XHR DONE!"),console.log(this.responseText),self._onComplete("upload","upload done")}),xhr.addEventListener(Titanium.HTTP_STATE_CHANGED,function(){console.log("STATE CHANGED"),console.log(this.responseText)}),xhr.onsendstream=function(e){console.log("#####ONSENDSTREAM - PROGRESS: "+e.dataSent)},xhr.setTimeout(-1),xhr.setRequestHeader("contentType","multipart/form-data"),xhr.open("PUT",dest),xhr.send(content)},_log:function(msg){this.logger.writeln(msg)},_initCallbacks:function(callbacks){var onProgressCallback=callbacks.onProgress||function(){},onErrorCallback=callbacks.onError||function(){},onCompleteCallback=callbacks.onComplete||function(){},self=this;this._onProgress=function(method,msg){self._onActionLog(method,msg),onProgressCallback(msg)},this._onError=function(method,msg){self._onActionLog(method,msg),onErrorCallback(msg)},this._onComplete=function(method,msg){self._onActionLog(method,msg),onCompleteCallback(msg)}},_onActionLog:function(method,msg){this._log(method+": "+msg)}}),Shipper}),define("localLogger",["underscore"],function(_){var LocalLogger=function(options){this._configure(options||{}),this.options=options};return _.extend(LocalLogger.prototype,{_configure:function(options){this.options={local:null,path:null},this.options&&(options=_.extend({},this.options,options)),this.options=options,this.local=this.options.local,this.path=this.options.path,this.local.initialize(),this.writeln("/************** "+new Date+" *********/")},write:function(content){this.local.append(this.path,content,function(){return})},writeln:function(content){this.write(content+Titanium.Filesystem.getLineEnding())}}),LocalLogger})